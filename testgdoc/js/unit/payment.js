"use strict";function CART_FEATURE(){this.dataUrl="/api/cart.ashx"}CART_FEATURE.prototype={delItem:function(e,t){$.post(this.dataUrl+"&B1=DEL&MODEL="+e+"&SPEC="+t,function(a){return console.log(a),"OK"==a.RS&&console.log("del this item success : MODEL = "+e+",SPEC = "+t),a})},addItem:function(e,t){$.post(this.dataUrl+"&B1=ADD&MODEL="+e+"&SPEC="+t,function(a){return console.log(a),"OK"==a.RS&&console.log("add this item success : MODEL = "+e+",SPEC = "+t),a})},getList:function(){$.post(this.dataUrl,function(e){return"OK"==e.RS,e})},getTest:function(){var e={};return e.RS="OK",console.log("test OK"),e}};var rentCart=new CART_FEATURE;!function(){function e(e,t,a,n,o,r,l){return i.replace(/\{+(NAME)+\}/g,e).replace(/\{+(SPEC)+\}/g,t).replace(/\{+(IMGURL)+\}/g,a).replace(/\{+(DAYPRICE)+\}/g,n).replace(/\{+(BONDPRICE)+\}/g,o).replace(/\{+(TOTALPRICE)+\}/g,r).replace(/\{+(DAYCOUNT)+\}/g,l)}function t(e,t){$.each(e,function(e,a){t[e]={},t[e].name=a.MODEL,t[e].spec=a.SPEC,t[e].imgurl=a.IMAGE,t[e].dayprice=a.PRICE,t[e].bondprice=a.PRICE_YA})}function a(t,a){var n=0;$(".item-table:not(.style-head)").remove(),t.length>0||($(".section-payment .wrap-ptable").find(".list-table").remove(),$(".section-payment .wrap-ptable").find(".summary").remove(),$(".section-payment .wrap-ptable").find(".helper").remove(),$(".section-payment .wrap-ptable").find(".btn-wrap").remove(),$(".section-payment .wrap-date").remove(),$(".section-payment .wrap-reservation").remove(),$(".section-payment .wrap-ptable").append(c)),$.each(t,function(t,o){var r=a*parseInt(o.dayprice)+parseInt(o.bondprice);n+=r,$(".list-table").append(e(o.name,o.spec,o.imgurl,numberWithCommas(o.dayprice),numberWithCommas(o.bondprice),numberWithCommas(r),a))}),$(".summaryprice").html(numberWithCommas(n))}function n(){$.getJSON("data/store.json",function(e,t){if("OK"==e.RS)$.each(e.DATA,function(e,t){_[e]={},_[e].sid=t.ID,_[e].name=t.STORE,$("select[name=store]").append("<option value="+t.ID+">"+t.STORE+"</option>")});else{e.RS;alert("RS NOT OK")}}).success(function(){console.log("get json success!")}).fail(function(){console.log("get json fail!")}).done(function(){console.log("get json done!")})}function o(){$.getJSON("data/mycart.json",function(e,a){if("OK"==e.RS)t(e.PRODUCTS,m);else{e.RS;alert("RS NOT OK")}}).success(function(){console.log("get json success!");var e=$("[name=rent_day_count]").val();a(m,e)}).fail(function(){console.log("get json fail!"),$(".section-payment .wrap-ptable").find(".list-table").remove(),$(".section-payment .wrap-ptable").find(".summary").remove(),$(".section-payment .wrap-ptable").find(".helper").remove(),$(".section-payment .wrap-ptable").find(".btn-wrap").remove(),$(".section-payment .wrap-date").remove(),$(".section-payment .wrap-reservation").remove(),$(".section-payment .wrap-ptable").append(c)}).done(function(){console.log("get json done!")})}function r(){var e=parseInt($(".wrap-date").find("input[name=rentday_pending]").val()),t=new Date,n=new Date,o=new Date;if(pendNextWorkDay(t),n.setDate(t.getDate()+e),e<5&&n.getDay()<t.getDay()){var r=2*Math.ceil(e/5);n.setDate(n.getDate()+r)}else if(e>4){var r=2*Math.floor(e/5);n.setDate(n.getDate()+r)}pendNextWorkDay(n),o.setFullYear(n.getFullYear()),o.setMonth(n.getMonth()),o.setDate(n.getDate()+1),console.log(n.getDate()+1),pendNextWorkDay(o),$(".datepicker[name=start_date]").val(n.getFullYear()+"/"+(parseInt(n.getMonth())+1)+"/"+n.getDate()),$(".datepicker[name=end_date]").val(o.getFullYear()+"/"+(parseInt(o.getMonth())+1)+"/"+o.getDate());var s=daysBetween($("[name=start_date]").val(),$("[name=end_date]").val());$("[name=rent_day_count]").val(s),l();var i=new Date,c=parseInt($(".wrap-date").find("input[name=rentday_maximum]").val());i.setDate(o.getDate()+c),pendNextWorkDay(i),d=$(".datepicker[name=end_date]").pickadate({format:"yyyy/m/d",formatSubmit:"yyyy/m/d",min:o,max:i,monthsFull:u,monthsShort:y,weekdaysFull:v,weekdaysShort:f,showMonthsShort:!0,today:"",clear:"",disable:[1],onSet:function(){var e=daysBetween($("[name=start_date]").val(),$("[name=end_date]").val());$("[name=rent_day_count]").val(e),console.log(m),a(m,e)}})}function l(){var e=parseInt($(".wrap-date").find("input[name=rentday_pending]").val()),t=new Date,a=new Date;if(pendNextWorkDay(t),a.setDate(t.getDate()+e),e<5&&a.getDay()<t.getDay()){var n=2*Math.ceil(e/5);a.setDate(a.getDate()+n)}else if(e>=5){var n=2*Math.floor(e/5);a.setDate(a.getDate()+n)}pendNextWorkDay(a),p=$(".datepicker[name=start_date]").pickadate({format:"yyyy/m/d",formatSubmit:"yyyy/m/d",min:a,monthsFull:u,monthsShort:y,weekdaysFull:v,weekdaysShort:f,showMonthsShort:!0,today:"",clear:"",disable:[1,7],onOpen:function(){console.log("open start!"),D=$(".datepicker[name=start_date]").val()},onSet:function(){console.log("setted up!");var e=$(".datepicker[name=start_date]").val();e!=D&&($(".block-end_date").html(g),$("[name=rent_day_count]").val(""),s())}})}function s(){var e=(new Date,$("[name=start_date]").val()?new Date($("[name=start_date]").val()):new Date),t=parseInt($(".wrap-date").find("input[name=rentday_maximum]").val()),n=new Date($("[name=start_date]").val());e.setDate(e.getDate()+1),pendNextWorkDay(e),n.setDate(n.getDate()+t-1),pendNextWorkDay(n),$(".datepicker[name=end_date]").val(e.getFullYear()+"/"+(parseInt(e.getMonth())+1)+"/"+e.getDate());var o=daysBetween($("[name=start_date]").val(),$("[name=end_date]").val());$("[name=rent_day_count]").val(o),console.log(m),a(m,1),d=$(".datepicker[name=end_date]").pickadate({format:"yyyy/m/d",formatSubmit:"yyyy/m/d",min:e,max:n,monthsFull:u,monthsShort:y,weekdaysFull:v,weekdaysShort:f,showMonthsShort:!0,today:"",clear:"",disable:[1,7],onSet:function(){var e=daysBetween($("[name=start_date]").val(),$("[name=end_date]").val());$("[name=rent_day_count]").val(e),console.log(m),a(m,e)}})}var i=$(".section-payment").length>0?$(".section-template").find(".template-ptable").html():0,c=$(".section-payment").length>0?$(".section-template").find(".template-msg-empty").html():0;$(".section-template").find(".template-ptable").remove();var p,d,m=[],u=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],y=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],v=["週日","週一","週二","週三","週四","週五","週六"],f=["日","一","二","三","四","五","六"],g=$(".block-end_date").html(),h=$(".block-start_date").html(),D=$(".datepicker[name=start_date]").val(),_=[];n(),o(),r(),$(".list-table").on("click",".btn-del",function(e){var t=$(this).closest(".item-table").find(".name").text(),n=$(this).closest(".item-table").find(".spec").text();console.log("del this item : MODEL = "+t+",SPEC = "+n);var o=rentCart.getTest();if("OK"==o.RS){var r=[];$.each(m,function(e,a){a.name==t&&a.spec==n||r.push(a)}),m=r,console.log(m);var l=$("[name=rent_day_count]").val();a(m,l)}else popAlert(o.RS)}),$(".btn-confirm").on("click",function(e){$(".wrap-reservation").show();var t=$(".datepicker[name=start_date]").val(),a=$(".datepicker[name=end_date]").val();$(".block-start_date").html(h),$(".block-end_date").html(g),$(".datepicker").removeClass("datepicker"),$("[name=start_date]").val(t),$("[name=end_date]").val(a),$(".list-table").find(".for-x").remove(),$(this).remove()}),$("[name=tel]").on("change",function(e){var t=$(this).val().replace(/-/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/[^0-9&&^#]/g,"");$(this).val(t)});var w=new POPUP_FEATURE;$(".open-terms").on("click",function(e){e.preventDefault();var t=$(".template-term").html();w.popup(t),w.popupOpen(),setTimeout('$("body").find(".layout-popup-background,.layout-popup-wrap").addClass("is-on");',100)}),$(".btn-send").on("click",function(e){e.preventDefault();var t="您的預約申請已送出<br>將有專人透過您填寫的資料與您聯繫",a="<p>"+t+'</p><div class="btn-wrap"><a class="style-btn do-popclose">確定</a></div>';popAlert(a,!0)})}();
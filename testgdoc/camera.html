

<!DOCTYPE html>
<html lang="zh-tw">

<head>

<meta charset="UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0" />
<meta name="Title" content="SITENAME" />
<meta name="Author" content="" />
<meta name="Description" content="SITENAME" />


  <meta property="og:title" content="SITENAME" />

  <meta property="og:type" content="website" />

  <meta property="og:url" content="" />

  <meta property="og:image" content="images/share1200x630.jpg" />

  <meta property="og:site_name" content="SITENAME" />

  <meta property="og:description" content="SITENAME" />

  <meta property="og:locality" content="Taiwan" />

  <meta property="og:country-name" content="Taiwan" />

<title>SITENAME</title>
<!-- FAV ICONS -->



<link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon" />

<!-- GLOBAL CSS -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="css/vendor/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="css/global.css">
<!-- IN-PAGE CSS -->
<!-- start specific_stylesheet -->
<link rel="stylesheet" type="text/css" href="css/unit/camera.css" />

<!-- end specific_stylesheet -->
</head>

<body>

<!-- 如果有登入 - 加一個CLASS: .is-login -->
<div class="layout-container is-login">
<!-- HEADER START -->

<!-- HEADER END   -->

<!-- CONTENT START -->
<div id="layout-view" class="layout-view camera">
<!-- start content -->
<section class="section-camera">
	<div class="inner">
		<div class="square" id="canvas_outer">
			<p class="msg">點擊選擇您的照片或拍照</p>
			<input type="file" class="btn-choosefile" id="btn-choosefile" />
		</div>
	</div>
</section>


<!-- end content -->
<!-- <div class="btn-backtop is-hide"></div> -->
</div>
<!-- CONTENT END   -->

<!-- FOOTER START -->

<footer id="footer">
	<nav class="footer-nav">
		<ul class="footer-nav-list">
			
			<li class="footer-nav-item">
				<a href="index.html" >
					<i class="fa fa-home"></i>
					<span class="name">HOME</span>		
				</a>
			</li>
			
			<li class="footer-nav-item">
				<a href="space.html" >
					<i class="fa fa-map"></i>
					<span class="name">SPACES</span>		
				</a>
			</li>
			
			<li class="footer-nav-item">
				<a href="camera.html" >
					<i class="fa fa-camera"></i>
					<span class="name">CAMERA</span>		
				</a>
			</li>
			
			<li class="footer-nav-item">
				<a href="info.html" >
					<i class="fa fa-info-circle"></i>
					<span class="name">INFO</span>		
				</a>
			</li>
			
			<li class="footer-nav-item">
				<a href="goods.html" >
					<i class="fa fa-gift"></i>
					<span class="name">GOODS</span>		
				</a>
			</li>
			
		</ul>
	</nav>
</footer>
<!-- FOOTER END   -->
</div>

<!-- GLOBAL JS START -->
<!-- JS LIBRARY -->
<script type="text/javascript" src="js/vendor/jquery.min.js"></script>
<script type="text/javascript" src="js/vendor/fastclick.js"></script>
<script type="text/javascript" src="js/vendor/svg4everybody.min.js"></script>

<script src="js/vendor/pickadate/picker.js" type="text/javascript"></script>
<script src="js/vendor/pickadate/picker.date.js" type="text/javascript"></script>
<script src="js/vendor/pickadate/legacy.js" type="text/javascript"></script>
<!-- <script src='js/vendor.js'></script> -->
<!-- GLOBAL JS -->
<script type="text/javascript" src="js/initialization.js"></script>
<!-- 結帳頁不要載這隻 -->

<!-- <script type="text/javascript" src="js/module/cart.js"></script> -->


<!-- GLOBAL JS END   -->
<!-- IN-PAGE JS START -->
<!-- start specific_javascript -->
<script src="js/vendor/exif.js"></script>
<script>
//convert to base 64
File.prototype.convertToBase64 = function(callback){
	var reader = new FileReader();
	reader.onload = function(e) {
		callback(e.target.result)
	};
	reader.onerror = function(e) {
		callback(null, e);
	};        
	reader.readAsDataURL(this);
};

function CreateImageCanvas(img,x,y,w,h,myOri) {
	var canvas = document.createElement("canvas");
	canvas.width = w;
	canvas.height = h;
	document.getElementById("canvas_outer").appendChild(canvas);
	var ctx = canvas.getContext("2d");
	ctx.drawImage(img, x, y, w, h,0,0,w,h);
	console.log( myOri );

	var myFrame = document.createElement('img');
	// var myFrame = new Image();
	myFrame.src="img/frame.png";
	myFrame.setAttribute('crossOrigin', 'anonymous');
	myFrame.onload =function() {
		var fw = myFrame.width;
		var fh = myFrame.height;
		// alert(myFrame.width +","+ myFrame.height);
	    if ( typeof myOri != undefined ){
	      if ( myOri == 6 ){
	      ctx.rotate(90*Math.PI/180);
	      // ctx.fillStyle="#FF0000";
	      // ctx.fillRect(0,-w,w,w);
	      ctx.drawImage(img, x, y, w, h,0,-w,w,w);
	      ctx.rotate(-90*Math.PI/180);
	      }else
	      if ( myOri == 8 ){
	      ctx.rotate(-90*Math.PI/180);
	      // ctx.fillStyle="#FF0000";
	      // ctx.fillRect(-w,0,w,w);
	      ctx.drawImage(img, x, y, w, h,-w,0,w,w);    
	      ctx.rotate(90*Math.PI/180);
	      }else
	      if ( myOri == 3 ){
	      ctx.rotate(180*Math.PI/180);
	      // ctx.fillStyle="#FF0000";
	      // ctx.fillRect(-w,-w,w,w);
	      ctx.drawImage(img, x, y, w, h,-w,-w,w,w);      
	      ctx.rotate(-180*Math.PI/180);
	      }else{
	      }   
	    }

		ctx.drawImage(myFrame, 0, 0, fw , fh ,0,0,w,w);    
	};




// context.drawImage(img,sx,sy,swidth,sheight,x,y,width,height);
	var dataURL = canvas.toDataURL("image/png");
	return dataURL;

  // return dataURL.replace("data:image/png;base64,", "");
}

function getImgSize(myTarget){
	var start_x = 0;
	var start_y = 0;
	var size_sq = 0;
	var img_w = myTarget.width;
	var img_h = myTarget.height;
	if (img_w > img_h ){//橫
		start_x = (img_w - img_h ) / 2;
	}else{ //直
		start_y = (img_h - img_w ) / 2;
	}
	size_sq = img_w < img_h ? img_w : img_h ;
	return [start_x,start_y,size_sq];
}
$("body").find('#btn-choosefile').on('change', function(event) {
	event.preventDefault();
	var selectedFile = this.files[0];
	var img_size = 0;
	var img_crop_coordinate = [];
	var img_src = URL.createObjectURL(event.target.files[0]);
	var myOriVal = 0;
	var myImg = document.createElement('img');
	// var myImg = new Image();
	myImg.src=img_src;
	myImg.setAttribute('crossOrigin', 'anonymous');
	myImg.onload =function() {
		img_size = getImgSize(myImg)[2];
		img_crop_coordinate.push(getImgSize(myImg)[0]);
		img_crop_coordinate.push(getImgSize(myImg)[1]);

	    //fix iOS photo rotate bug
	    EXIF.getData( myImg , function() {
	        var myOri = EXIF.getTag(this, 'Orientation');
	        console.log( "EXIF CALLBACK! Orientation is : " + myOri );
	        myOriVal = myOri;
			CreateImageCanvas(myImg,img_crop_coordinate[0],img_crop_coordinate[1],img_size,img_size,myOri);
	    });

	}

	$(".msg,.btn-choosefile").addClass('is-hide');
	// $(".square").attr("style","background-image: url("+img_src+")").delay(100).queue(function() {
	// 	$(this).addClass('yama')
	// 	$(this).dequeue();
	// });
});
</script>

<!-- end specific_javascript -->
<!-- IN-PAGE JS END -->
</body>
</html><!--2017_7_11_04_51-->